+++
draft = true
thumbnail = "images/practical-monitoring/title.jpg"
tags = ["オライリー","運用"]
categories = ["書評"]
date = "2019-03-17T17:51:01+09:00"
title = "入門 監視を読んだ"
description = ""
+++

入門 監視を読みました。当方、監視もするアプリケーションエンジニアです。

```
第Ⅰ部　監視の原則
1章　監視のアンチパターン
2章　監視のデザインパターン
3章　アラート、オンコール、インシデント管理
4章　統計入門

第Ⅱ部　監視戦略
5章　ビジネスを監視する
6章　フロントエンド監視
7章　アプリケーション監視
8章　サーバ監視
9章　ネットワーク監視
10章　セキュリティ監視
11章　監視アセスメントの実行

付録A　手順書の例：Demo.App
付録B　可用性表
付録C　実践.監視SaaS
```

## この本の対象読者
監視に関わる人、もっと言うと監視の基本的な理解を深めたい人向けの本と冒頭に書かれていますので入門書です。
原題は「practical Monitoring」なので「実践 監視」となりますよね。でも「入門 監視」と翻訳したのはしっくり来ました。

## 監視の定義　〜はじめにより〜

> 監視とは、あるシステムやそのシステムのコンポーネントの振る舞いや出力を観察しチェックし続ける行為である。

監視とは問題に気づくことだと思っていましたが、観察しチェックし続けることだと言っています。
すでに発生してしまっている問題に気づくのはもちろん重要ですが、普段からシステムを観察することで、問題の予兆に気づいて防げたらその方が重要なんだと。自分の場合、問題が起きてから監視ツールを開く場合がほとんどで、正常時のメトリクスを見るのは意識しないと難しいなと思いました。

## 監視のアンチパターン

### アンチパターン１：ツール依存

私たちが監視しているものは、アプリケーション、データベース、OS、ネットワークなど多岐に渡るのに単一のツールで監視しようとするのはアンチパターンです。それぞれに合った監視ツールの導入を検討した方が良い。ツールを増やすことを怖がる必要はないが、人づてに評判を確かめるなど慎重に選択する必要はある。監視の目的がはっきりしていないけどオールインワンのツールを選択して監視することに満足してしまうよりかは、ちゃんと監視する対象と何を監視したいのかを明確にしてそれに合ったツールを選択するのが良いということ。これはうちのサービスでは出来ていません。

### アンチパターン２：役割としての監視

監視は役割にしてはいけない。チーム全員がある程度の監視スキルを持つべきというもの。
DevOpsの重要な要素として、インフラチームだけでなく全員が本番環境の責任をもつ必要がある。
うちのチームの場合、監視はローテーション制にしていますが特定の人だけで回しているので監視スキルが偏っていてアンチパターンに陥っていました。
まあ理想はそうだとは思いつつ、新人や派遣社員がいる状況でこれを満たすのはかなり難しいと思いました。
ではどうすれば良いのかは、この本の中では触れられてない気がしますが、重要性を主張してやってもらうしかないのか少しモヤモヤしました。

### アンチパターン３：チェックボックス監視

「これを監視しています」と言いたいがためだけの、いわばチェックボックスを満たすために意味のない監視をしてしまうアンチパターン。外圧によりやらされているようなチェックもあるでしょう。
うちのサービスもこの本で散々名前が出てくるNagiosから大量のアラートメールが飛んできますが、何が問題なのか分からないので正直全然見ていないのでもろにアンチパターンですね。

### アンチパターン４：監視を支えにする　＆　アンチパターン５：手動設定

当たり前ですが監視だけしていても壊れてしまったものが直る訳ではない。自動で回復させる取り組みにも時間を割くべきです。うちでは復旧は手動なものばかりなので、これもアンチパターンでした。

5つのアンチパターンすべてに当てはまっていました。

## 監視のデザインパターン

アンチパターンに対する解決策として4つのデザインパターンが挙げられています。

### デザインパターン１：組み合わせ可能な監視

アンチパターン１のツール依存に対する解決方法。UNIXの哲学で1つのことをうまくやるツールの組み合わせることが大事。

### デザインパターン２：ユーザ視点での監視

結局、ユーザがシステムを「使えているか」が重要なので監視もそれに合わせて行うべき。OSのメトリクスばかり気にしても無駄なのでユーザから見た世界、ロードバランサーの外側からの監視が重要。

### デザインパターン３：作るのではなく買う

オンプレミスに監視の仕組みを構築するよりSaaSを使った方が結局安いしたくさんメリットがある。

### デザインパターン４：継続的改善　

良い監視の仕組みは一朝一夕には出来ないので継続的な改善を続けていく必要がある。

監視の難しさ
社員がいない。偏っている。
アラートを見逃すと怒られる。

監視はスキルであり、役割ではない。
アラートの味方が職人芸。
アラートが多すぎて、どれが無視して良いのかわからない。

アラートより自動復旧を。

全員監視。

インシデント管理


### 


{{% amazon
  itemId="4873118646"
  title="入門 監視 ―モダンなモニタリングのためのデザインパターン"
  author="Mike Julian"
  publisher="オライリージャパン"
  imageUrl="https://images-fe.ssl-images-amazon.com/images/I/41Jlj3e0CDL._SL160_.jpg"
%}}
